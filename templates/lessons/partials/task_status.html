{% load partials %}

<span id="task-status-info">
    {% partialdef task-status-info %}
        {% if task_id %}
            {% if not is_complete %}
                <div style="background-color: #e3f2fd; border-left: 4px solid #2196f3; padding: 15px; border-radius: 3px; margin-bottom: 20px;">
                    <p>Статус: {{ status }}</p>
                </div>
                <td {% if task_result is "SUCCESS" %}hx-trigger="success" hx-get="none"
                    {% elif task_result is "FAILURE" %}hx-trigger="failure" hx-get="none"
                    {% else %}
                        hx-get="{% url 'task_status' task_id %}"
                    {% endif %}
    {#                hx-target="backup-{{ backup.id }}"#}
                    hx-trigger="every 3s"
                    hx-indicator="#loading_dots"
                    hx-on:success="task-status-info.close(); this.reset();"
                    hx-swap="outerHTML every 3s">
                    {% include 'lessons/partials/indicator_balls.html' %} {{ task_result }}
                </td>
            {% else %}
                <!-- Задача завершена, опрос прекращён -->
            {% endif %}
        {% endif %}
    {% endpartialdef task-status-info %}
</span>
{#        {% if task_id %}#}
{#        <div id="task-status" hx-get="{% url 'task_status' task_id %}" hx-trigger="load, every 5s[!this.classList.contains('task-complete')]" hx-target="this" hx-swap="innerHTML">#}
{#            <p>Статус задачи: Загрузка...</p>#}
{#        </div>#}
{#        <script>#}
{#            document.addEventListener('htmx:afterSwap', function(e) {#}
{#                if (e.detail.target.id === 'task-status' && e.detail.target.innerHTML.includes('Задача завершена')) {#}
{#                    e.detail.target.classList.add('task-complete');#}
{#                }#}
{#            });#}
{#        </script>#}
{#        {% endif %}#}
