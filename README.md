# IT School Test Task

Django-приложение для управления уроками в школе.

## Описание проекта

Это Django-приложение разработано для управления учебным процессом в IT-школе. Приложение позволяет создавать и управлять уроками, группами, студентами, преподавателями и предметами. Основные возможности включают асинхронную рассылку уведомлений студентам о предстоящих уроках через Celery, динамическое обновление интерфейса с использованием HTMX без необходимости в JavaScript, цветное логирование для удобства отладки, и развертывание в Docker для простоты и изоляции среды.

### Текущее состояние проекта

Проект находится в стадии разработки и включает следующие компоненты:
- Модели данных: Course (курс), Group (группа), Student (студент), Teacher (преподаватель), Subject (предмет), Lesson (урок).
- Веб-интерфейс на основе Django и HTMX для создания и просмотра уроков.
- Асинхронные задачи с Celery для отправки уведомлений.
- Интеграция с PostgreSQL для хранения данных и Redis для кэширования и брокера сообщений.
- Управление зависимостями через UV.
- Docker-контейнеризация для упрощения развертывания.

## Функционал

- Модели: Course, Group, Student, Teacher, Subject, Lesson
- Создание уроков с асинхронной рассылкой уведомлений студентам через Celery
- HTMX для обновления интерфейса без JS
- Цветное логирование
- Docker для развертывания
- Управление миграциями базы данных
- Заполнение тестовыми данными через кастомные команды Django

## Архитектура

- **PostgreSQL**: база данных для хранения всех данных приложения.
- **Redis**: кэш и брокер сообщений для Celery.
- **Celery**: асинхронные задачи для рассылки уведомлений.
- **Django + HTMX**: веб-интерфейс для управления уроками.
- **UV**: менеджер зависимостей для Python.
- **Docker Compose**: оркестрация сервисов (web, db, redis).

## Установка и запуск

### Процедура клонирования репозитория из GitHub

1. Убедитесь, что у вас установлен Git. Если нет, скачайте и установите его 
   с официального сайта: https://git-scm.com/downloads.

2. Откройте командную строку или терминал.

3. Перейдите в директорию, где вы хотите разместить проект (например, `cd ~/projects`).

4. Клонируйте репозиторий с GitHub (замените `username` на актуальное имя пользователя или организации):

   ```bash
   git clone https://github.com/username/itschooltt.git
   ```

5. Перейдите в директорию проекта:

   ```bash
   cd itschooltt
   ```

### Установка виртуального окружения UV

UV - это быстрый менеджер зависимостей для Python. Для установки и настройки виртуального окружения выполните следующие шаги:

1. Установите UV, если он не установлен. Рекомендуется использовать pip:

   ```bash
   pip install uv
   ```

2. Синхронизируйте зависимости проекта. Это создаст виртуальное окружение и установит все необходимые пакеты, указанные 
   в `pyproject.toml`:

   ```bash
   uv sync
   ```

   Эта команда создаст директорию `.venv` с виртуальным окружением и установит зависимости, такие как Django, Celery, 
   psycopg2-binary и другие.

3. Активируйте виртуальное окружение (опционально, если вы планируете запускать команды вручную):

   - На Windows:
     ```bash
     .venv\Scripts\activate
     ```
   - На macOS/Linux:
     ```bash
     source .venv/bin/activate
     ```

### Начальный запуск приложения с использованием Docker-compose

Для развертывания приложения в изолированной среде используйте Docker Compose. 
Это рекомендуется для разработки и производства.

1. Установите Docker и Docker Compose, если они не установлены. 
   Скачайте с официального сайта: https://www.docker.com/products/docker-desktop.

2. В директории проекта запустите сервисы:

   ```bash
   docker-compose up --build -d
   ```

   - `--build`: пересоберет образы, если Dockerfile изменился.
   - `-d`: запустит сервисы в фоновом режиме.

   Это запустит три сервиса: web (Django-приложение), db (PostgreSQL), redis.

3. При первом запуске создайте и затем примените миграции внутри контейнера:

   ```bash
   docker-compose exec web uv run python manage.py makemigrations
   ```

   ```bash
   docker-compose exec web uv run python manage.py migrate
   ```

4. Заполните базу данных тестовыми данными:

   ```bash
   docker-compose exec web uv run python manage.py create_test_data
   ```

5. Откройте браузер и перейдите по адресу: http://localhost:8000

   Приложение будет доступно на порту 8000.

### Локальная установка (альтернатива Docker)

Если вы предпочитаете локальную установку без Docker:

1. Установите UV и синхронизируйте зависимости, как описано выше.

2. Настройте PostgreSQL и Redis локально:
   - Установите PostgreSQL (версия 15 или выше).
   - Создайте базу данных `itschooltt` с пользователем `postgres` и паролем `password`.
   - Установите Redis.

3. Установите переменные окружения (создайте файл `.env` или установите в системе):
   - `DEBUG=True`
   - `DB_HOST=localhost`
   - `DB_NAME=itschooltt`
   - `DB_USER=postgres`
   - `DB_PASS=password`
   - `REDIS_URL=redis://localhost:6379/0`
   - `CELERY_BROKER_URL=redis://localhost:6379/0`
   - `CELERY_RESULT_BACKEND=django-db`

4. Запустите приложение:
   ```bash
   uv run python manage.py migrate
   uv run python manage.py create_test_data
   uv run python manage.py runserver
   uv run celery -A itschooltt worker --loglevel=info
   ```

## Команды

- `uv run python manage.py create_test_data` - заполнить тестовыми данными
- `uv run celery -A itschooltt worker --loglevel=info` - запустить Celery worker
- `uv run python manage.py runserver` - запустить сервер разработки
- `docker-compose down` - остановить и удалить контейнеры
- `docker-compose logs` - просмотреть логи сервисов
