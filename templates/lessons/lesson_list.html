{% load static %}
{% load partials %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Уроки</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" type="text/css" href="{% static 'css/styles.css' %}">
</head>
<body>
    <div class="w-full px-0 py-1 pt-1">
        <div class="form-section gap-1">
            <h2 class="text-xl text-centered font-bold text-gray-800">Создать новый урок</h2>
            {% include 'lessons/lesson_form.html' %} {% include 'lessons/partials/task_status.html' %}
        </div>
        <h1 class="text-xl font-bold">Список уроков</h1>
        <table class="table table-sm">
            <thead class="text-sm text-medium">
                <tr>
                    <th>id</th>
                    <th>Название</th>
                    <th>Описание</th>
                    <th>Предмет</th>
                    <th>Преподаватель</th>
                    <th>Группа</th>
                    <th>Дата и время</th>
                    <th>Статус</th>
                    <th>Действия</th>
                </tr>
            </thead>
            <tbody class="text-sm text-medium" id="lessons-tbody">
            {% partialdef lessons-tbody inline %}
                {% for lesson in lessons %}
                <tr class="lesson-row" id="lesson-{{ lesson.pk }}">
                    <td>{{ lesson.id }}</td>
                    <td>{{ lesson.title }}</td>
                    <td>{{ lesson.description|truncatewords:5 }}</td>
                    <td>{{ lesson.subject.name }}</td>
                    <td>{{ lesson.teacher.name }}</td>
                    <td>{{ lesson.group.name|default:"—" }}</td>
                    <td>{{ lesson.scheduled_at|date:"d.m.Y H:i" }}</td>
                    <td>
                        <span class="status-{{ lesson.status }}">
                            {{ lesson.get_status_display }}
                        </span>
                    </td>
                    <td>
                        <div class="actions">
                            {% if lesson.status == 'created' %}
                            <form hx-post="{% url 'lesson_complete' lesson.pk %}" hx-target="#lesson-{{ lesson.pk }}" hx-swap="outerHTML" style="margin: 0;">
                                {% csrf_token %}
                                <button type="submit" class="btn-complete">Завершить</button>
                            </form>
                            {% else %}
                            <button class="btn-complete" disabled>Завершить</button>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8" style="text-align: center; color: #999;">Нет уроков</td>
                </tr>
                {% endfor %}
            {% endpartialdef lessons-tbody %}
            </tbody>
        </table>
    </div>
</body>
</html>